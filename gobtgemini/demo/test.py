
# 必须在所有代码的最前面
__import__('pysqlite3')
import sys
sys.modules['sqlite3'] = sys.modules.pop('pysqlite3')


import chromadb

import numpy as np
import pprint # 使用 pprint 模块让字典输出更美观

# 如果是本地持久化存储 (数据保存在磁盘的 .chroma 文件夹)
# client = chromadb.PersistentClient(path="/path/to/your/db") 

# 如果是连接到 Docker 或远程服务器
client = chromadb.HttpClient(host='localhost', port=8000)

# 如果是临时在内存中使用（程序结束数据消失）
#client = chromadb.Client() 

# 为了演示，我们先创建一个并添加一些数据
collection_name = "chat_memory"
try:
    collection = client.get_collection(name=collection_name)
    query_vector = [[0.043598257,-0.0022311313,0.044134922,-0.02659358,0.0147129,0.0022557538,0.016198024,0.0272457,0.030380115,-0.0063962205,0.02727489,-0.009363814,0.030667095,-0.0013719471,-0.03947619,0.005812998,0.0074624135,-0.07170792,-0.058545727,-0.020905428,-0.060391128,0.012725221,-0.031992693,0.015450147,0.098854385,-0.031955454,-0.0050339815,0.046915166,-0.008991441,-0.14854567,-0.01883977,0.00670268,-0.042830218,0.031303324,-0.00850649,0.04783975,0.036998052,0.0053580753,-0.0014706634,0.02190946,-0.002978211,-0.015143494,-0.031298604,0.04614894,0.016210804,0.021585034,0.035752833,0.031490657,0.049051493,0.0111156395,0.065346606,0.019837813,-0.043833748,-0.00443849,0.017562129,0.08567088,0.01987214,0.04467172,0.010419317,0.009822413,0.024454381,0.010090605,-0.18236575,0.09391038,-0.04686786,-0.09617939,-0.047693532,-0.06979911,-0.04707297,0.10866344,0.00045610138,-0.0047586393,-0.02505292,-0.037672523,-0.005640878,0.011517825,0.047311835,-0.0046438957,0.060251907,-0.059515346,0.037385397,0.06587722,0.01654636,-0.03709259,-0.021329103,0.02809985,-0.010220168,0.076882385,-0.023367003,-0.05280061,0.0107395435,-0.02456967,0.1052713,0.024034716,0.068173245,0.013432924,0.0385697,0.03616982,0.020791814,0.43801346,-0.025294175,-0.001936939,-0.034667995,-0.097504094,-0.0063185217,-0.03978872,-0.03668061,0.032918077,-0.03180003,-0.038919523,-0.02536301,-0.032347184,-0.0139339175,0.00095221144,0.030558765,0.025805758,-0.07412324,-0.012193666,0.013105109,0.022446191,-0.024207506,-0.007109786,-0.02204363,-0.056096625,-0.015615012,-0.10978446,0.06828412,0.0031321442,-0.012674169,0.011216424,0.006918485,0.023697352,-0.03536648,0.025357628,0.0109842,-0.0136253,0.0370019,-0.014128511,-0.0013007744,-0.07280484,-0.05076276,0.035322078,-0.033446584,0.0041074553,0.0005892694,-0.050714962,0.07267101,-0.023987388,-0.0019776304,-0.031320628,0.026187325,-0.023101667,0.032164942,0.013320809,0.030816326,-0.040866684,-0.02137488,-0.05442998,-0.0024009214,0.054204796,0.018108882,0.032575343,-0.045998257,-0.021460392,-0.030033225,0.030307928,-0.007162048,0.018347895,0.06350524,0.087367974,-0.026703127,-0.0028573107,0.0066993916,0.015280571,0.026219975,-0.030466048,0.0042268317,0.024957782,0.0283234,0.028695967,0.014978305,-0.02033765,-0.049020786,0.027005412,-0.027907748,-0.0005047267,-0.040563703,-0.0077543687,0.032632392,-0.010433727,0.016454527,-0.0199747,-0.012852554,0.0365987,-0.006335994,-0.007857328,0.0058625205,0.08368603,0.06312054,0.007065009,-0.15465438,-0.053740464,0.015954597,-0.010755332,0.11324273,-0.033889595,0.049795017,-0.04495128,0.0025309534,-0.027028479,-0.0024714952,-0.0008222517,0.06522712,0.034557782,0.017462065,-0.025081843,0.009626567,0.018915156,-0.12383846,-0.025092375,0.05704718,0.015614233,0.04402188,-0.13656141,0.10282871,-0.023798414,-0.04573874,0.046071343,0.01589496,-0.010278144,0.017763803,0.078498356,-0.06247025,0.019247122,-0.00075737445,-0.045582566,0.021880522,0.012223638,-0.10855711,0.0050710374,-0.00082440913,-0.012293038,0.05078855,0.010630729,0.0861622,-0.02205223,-0.07015256,0.11222717,0.004270521,0.12527132,-0.003249349,-0.0075187497,-0.056315523,-0.0024355731,-0.06032882,-0.019205771,-0.0816256,0.042525724,0.022898994,0.08123203,0.033370014,-0.05544504,-0.058041915,-0.022914808,-0.011245102,-0.06682381,-0.04444053,0.08536198,0.04603854,0.036584422,0.010808455,-0.0008708679,-0.01179279,-0.017314462,0.003573966,-0.07947742,0.02473982,0.005512723,-0.0113324,0.067362644,-0.05495237,-0.08605371,-0.005155,0.07373734,-0.048230205,-0.03269876,0.07139281,0.024017876,0.008088931,0.018432286,-0.00029939276,0.032089237,-0.048452064,-0.020308007,0.0070403693,-0.039237343,-0.07775314,0.053817775,0.032256003,0.037084896,-0.038732737,-0.029661285,-0.012014856,-0.023869008,0.009024052,-0.011101507,-0.01788005,0.007063377,0.023612097,0.017769162,0.01041152,-0.01098355,0.0017548731,0.021886308,-0.010366881,-0.030095963,-0.019508751,0.004439984,-0.015152605,-0.1753128,-0.010776561,-0.057599805,-0.09028536,0.038290568,0.11377743,0.09535883,0.041404378,-0.031725507,0.05628765,-0.11187839,0.006907064,0.021874651,0.03551066,-0.08130523,0.024628349,0.05227167,-0.091519736,-0.02084112,-0.045847375,0.011242287,0.045087468,0.04606787,0.030351622,0.0020032793,-0.012854806,0.024672678,-0.028120846,0.07337033,0.010533977,0.019762106,0.011944112,-0.053705186,-0.08500736,-0.0137245925,-0.01642327,-0.004904295,0.004584046,0.023939498,-0.0028839256,-0.019577939,0.030516943,0.0028841612,0.018736511,0.08065802,-0.056276068,0.019781861,-0.012271879,0.01531312,-0.02855817,-0.05664101,0.002449548,-0.0010933873,-0.025665209,-0.043054473,0.08286467,-0.07180767,0.002437846,0.023231372,-0.09514744,0.0046342756,0.015613428,-0.0023861765,0.04884152,0.01895744]]
    user_id_to_find = "e67fa973-acb0-4fff-b27a-51c94845a819"
    # 您想返回的结果数量
    num_results = 3

    # 您的元数据过滤器 (where clause)
    # 这个字典结构和 JSON 中的完全一样
    where_filter = {
        "user_id": {
            "$eq": user_id_to_find
        }
    }


    # --- 3. 执行查询并打印结果 ---

    print("--- 正在执行查询... ---")
    print(f"查询条件: 返回 {num_results} 个结果，并且 user_id 必须是 '{user_id_to_find}'")

    results = collection.query(
        query_embeddings=query_vector,
        n_results=num_results,
        where=where_filter,
        include=["documents", "metadatas", "distances"] # 指定返回内容
    )

    print("\n--- 查询结果 ---")
    pprint.pprint(results)
except Exception as e:
    print(f"加载集合失败: {e}")
    # 如果集合不存在，后续操作将无法进行



    POST /api/v1/collections/deff8c23-10a3-4067-bd49-727baad192fd/query请问这个url中的deff8c23-10a3-4067-bd49-727baad192fd是怎么来的？


